{% extends 'base.html.twig' %}

{% block title %}
	{% if is_admin_view|default(false) %}All Reservations{% else %}My Reservations
	{% endif %}
	- BiblioConnect
{% endblock %}

{% block body %}
	<div class="container py-4">
		<div class="row mb-4">
			<div class="col-md-8">
				<h1>
					{% if is_admin_view|default(false) %}All Reservations{% else %}My Reservations
					{% endif %}
				</h1>
				<p class="text-muted">
					{% if is_admin_view|default(false) %}
						Manage all reservations across the platform
					{% else %}
						View and manage your current reservations
					{% endif %}
				</p>
			</div>
			<div class="col-md-4 text-md-end d-flex justify-content-md-end align-items-center gap-2">
				{% if not is_admin_view|default(false) %}
					<a href="{{ path('app_reservation_cart') }}" class="btn btn-primary">
						<i class="fas fa-shopping-cart me-1"></i>
						View Cart
					</a>
				{% endif %}
			</div>
		</div>

		{% if reservations|length > 0 %}
			<div class="card shadow-sm">
				<div class="card-header bg-light">
					<h5 class="mb-0">
						{% if is_admin_view|default(false) %}Reservation List{% else %}Your Reservations
						{% endif %}
					</h5>
				</div>
				<div class="card-body">
					<div class="table-responsive">
						<table class="table table-hover">
							<thead>
								<tr>
									<th>Reservation #</th>
									<th>Date</th>
									{% if is_admin_view|default(false) %}
										<th>User</th>
										<th>Total Cost</th>
									{% endif %}
									<th>Items</th>
									<th>Actions</th>
								</tr>
							</thead>
							<tbody>
								{% for reservation in reservations %}
									<tr>
										<td>{{ loop.index }}</td>
										<td>{{ reservation.createdAt|date('Y-m-d H:i') }}</td>
										{% if is_admin_view|default(false) %}
											<td>{{ reservation.user.firstName }}
												{{ reservation.user.lastName }}</td>
											<td>{{ reservation_costs[reservation.id] }} â‚¬</td>
										{% endif %}
										<td>{{ reservation.reservationPublications|length }}
											publication{{ reservation.reservationPublications|length > 1 ? 's' : '' }}</td>
										<td>
											<a href="{{ path('app_reservation_show', {'id': reservation.id}) }}" class="btn btn-sm btn-outline-primary">
												View Details
											</a>
										</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				</div>
			</div>
		{% else %}
			<div class="alert alert-info">
				<i class="fas fa-info-circle me-2"></i>
				{% if is_admin_view|default(false) %}
					There are no reservations in the system.
				{% else %}
					You don't have any reservations yet.
				{% endif %}
			</div>

			{% if not is_admin_view|default(false) %}
				<div class="text-center mt-4">
					<a href="{{ path('app_publication_index') }}" class="btn btn-primary">
						<i class="fas fa-book me-1"></i>
						Browse Publications
					</a>
				</div>
			{% endif %}
		{% endif %}
	</div>
{% endblock %}
